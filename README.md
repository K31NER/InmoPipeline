<div align="center">

<img src="img/logo.png" alt="InmoPipeline Logo" width="200"/>

# üè° InmoPipeline
### *Pipeline Completo de An√°lisis del Mercado Inmobiliario Colombiano*

![Status](https://img.shields.io/badge/Status-Production-brightgreen?style=flat-square)
![Model](https://img.shields.io/badge/Model_R¬≤-70.07%25-blue?style=flat-square)
![Validation](https://img.shields.io/badge/External_Error-19.44%25-orange?style=flat-square)
![API](https://img.shields.io/badge/API-Live-success?style=flat-square&logo=render)
![Tests](https://img.shields.io/badge/Tests-282_Properties-informational?style=flat-square)

<p align="center">
  <img src="https://img.shields.io/badge/Python-Data_Engineering-3776ab?style=for-the-badge&logo=python&logoColor=white" alt="Python">
  <img src="https://img.shields.io/badge/DuckDB-Analytics_Database-FFF000?style=for-the-badge&logo=duckdb&logoColor=black" alt="DuckDB">
  <img src="https://img.shields.io/badge/Playwright-Web_Scraping-2EAD33?style=for-the-badge&logo=playwright&logoColor=white" alt="Playwright">
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Streamlit-Interactive_Dashboards-FF4B4B?style=for-the-badge&logo=streamlit&logoColor=white" alt="Streamlit">
  <img src="https://img.shields.io/badge/Scikit_Learn-Machine_Learning-F7931E?style=for-the-badge&logo=scikit-learn&logoColor=white" alt="Scikit-Learn">
  <img src="https://img.shields.io/badge/FastAPI-ML_&_MCP_Server-009688?style=for-the-badge&logo=fastapi&logoColor=white" alt="FastAPI">
  <img src="https://img.shields.io/badge/n8n-Workflow_Automation-EA4B71?style=for-the-badge&logo=n8n&logoColor=white" alt="n8n">
  <img src="https://img.shields.io/badge/Render-Cloud_Deployment-46E3B7?style=for-the-badge&logo=render&logoColor=white" alt="Render">
</p>

</div>

## üìã Tabla de Contenidos

- [üìä Descripci√≥n](#-descripci√≥n)
- [üèóÔ∏è Arquitectura del Proyecto](#Ô∏è-arquitectura-del-proyecto)
- [üîÑ Flujo del Pipeline](#-flujo-del-pipeline)
- [‚öôÔ∏è Tecnolog√≠as Utilizadas](#Ô∏è-tecnolog√≠as-utilizadas)
- [üîÆ Roadmap del Proyecto](#-roadmap-del-proyecto)

---

## üìä Descripci√≥n

**InmoPipeline** es un proyecto end-to-end de ingenier√≠a y ciencia de datos que implementa un pipeline completo para el an√°lisis del mercado inmobiliario colombiano. El proyecto integra las tres disciplinas fundamentales del ecosistema de datos moderno:

### üîß **Ingenier√≠a de Datos**
- **Web Scraping Automatizado**: Extracci√≥n de datos en tiempo real desde FincaRaiz.com.co
- **ETL Pipeline**: Procesos de extracci√≥n, transformaci√≥n y carga optimizados
- **Data Warehousing**: Almacenamiento eficiente con DuckDB

### üìä **An√°lisis de Datos**
- **An√°lisis Exploratorio**: Identificaci√≥n de patrones y tendencias del mercado
- **Dashboards Interactivos**: Visualizaciones din√°micas con Streamlit
- **KPIs del Mercado**: M√©tricas clave del sector inmobiliario

### ü§ñ **Ciencia de Datos**
- **Machine Learning**: Modelo Random Forest entrenado con **R¬≤ = 0.7007** y **MSE = 0.197**
- **Validaci√≥n Externa**: Testeo con **282 propiedades nuevas** obtenidas por web scraping
- **Error Absoluto**: **19.44%** en datos reales (concordante con m√©tricas de entrenamiento)
- **API de Predicci√≥n**: Endpoints REST desplegados en **Render Cloud** ‚ÜóÔ∏è [**inmopipeline.onrender.com**](https://inmopipeline.onrender.com)
- **Automatizaci√≥n**: Workflows inteligentes con **n8n** para consultas automatizadas

---

## üèóÔ∏è Arquitectura del Proyecto

```mermaid
graph TB
    subgraph "üåê Data Sources"
        A[FincaRaiz.com.co]
    end
    
    subgraph "‚ö° Data Ingestion"
        B[Playwright Scraper]
        C[Data Validation]
    end
    
    subgraph "üóÉÔ∏è Data Storage"
        D[DuckDB Database]
        E[CSV Exports]
    end
    
    subgraph "üîÑ Data Processing"
        F[Pandas/Polars ETL]
        G[Data Cleaning]
        H[Feature Engineering]
    end
    
    subgraph "üìä Analytics Layer"
        I[Streamlit EDA]
        J[Statistical Analysis]
        K[Interactive Dashboard]
    end
    
    subgraph "ü§ñ ML Pipeline"
        L[Scikit-Learn Models]
        M[Model Training]
        N[Model Validation]
        O[Model Persistence]
    end
    
    subgraph "üöÄ Deployment"
        P[FastAPI Service]
        Q[Render Cloud]
        R[Model Endpoints]
        S[n8n Workflows]
    end
    
    A --> B
    B --> C
    C --> D
    C --> E
    E --> F
    F --> G
    G --> H
    H --> I
    H --> J
    H --> K
    D --> L
    L --> M
    M --> N
    N --> O
    O --> P
    P --> Q
    P --> R
    I --> S
    S --> Q
```

---

## üîÑ Flujo del Pipeline

### Pipeline Detallado por Fases

#### **Fase 1: üï∑Ô∏è Data Extraction**
```mermaid
graph LR
    A[üåê FincaRaiz Portal] --> B[ü§ñ Playwright Scraper]
    B --> C[üìä Raw Data Collection]
    C --> D[‚úÖ Data Validation]
    D --> E[üóÉÔ∏è DuckDB Storage]
```

#### **Fase 2: üîÑ Data Transformation**
```mermaid
graph LR
    A[üóÉÔ∏è Raw Database] --> B[üßπ Data Cleaning]
    B --> C[üîß Feature Engineering]
    C --> D[üìà Statistical Analysis]
    D --> E[üíæ Processed Dataset]
```

#### **Fase 3: üìä Analytics & Visualization**
```mermaid
graph LR
    A[üíæ Clean Data] --> B[üéõÔ∏è Streamlit EDA]
    A --> C[üìà Statistical Analysis]
    B --> D[üìà Business Insights]
    C --> D
```

#### **Fase 4: ü§ñ Machine Learning**
```mermaid
graph LR
    A[üíæ Features Dataset] --> B[üß† Model Training]
    B --> C[‚úÖ Model Validation]
    C --> D[ÔøΩ External Testing]
    D --> E[ÔøΩüíæ Model Persistence]
    E --> F[üöÄ Render Deployment]
    F --> G[üîÑ n8n Automation]
```

---

## ‚öôÔ∏è Tecnolog√≠as Utilizadas

<div align="center">

### üîß **Data Engineering Stack**
| Tecnolog√≠a | Prop√≥sito |
|------------|-----------|
| ![Playwright](https://img.shields.io/badge/Playwright-2EAD33?style=flat&logo=playwright&logoColor=white) | Web Scraping Din√°mico |
| ![DuckDB](https://img.shields.io/badge/DuckDB-FFF000?style=flat&logo=duckdb&logoColor=black) | OLAP Database |
| ![Pandas](https://img.shields.io/badge/Pandas-150458?style=flat&logo=pandas&logoColor=white) | Data Manipulation |

### üìä **Analytics & Visualization**
| Tecnolog√≠a | Prop√≥sito |
|------------|-----------|
| ![Streamlit](https://img.shields.io/badge/Streamlit-FF4B4B?style=flat&logo=streamlit&logoColor=white) | Interactive Dashboards |

### ü§ñ **Machine Learning & Deployment**
| Tecnolog√≠a | Prop√≥sito |
|------------|-----------|
| ![Scikit-Learn](https://img.shields.io/badge/Scikit_Learn-F7931E?style=flat&logo=scikit-learn&logoColor=white) | Random Forest (R¬≤=0.7007) |
| ![FastAPI](https://img.shields.io/badge/FastAPI-009688?style=flat&logo=fastapi&logoColor=white) | ML & MCP API Server |
| ![Render](https://img.shields.io/badge/Render-46E3B7?style=flat&logo=render&logoColor=white) | Cloud Deployment |
| ![n8n](https://img.shields.io/badge/n8n-EA4B71?style=flat&logo=n8n&logoColor=white) | Workflow Automation |
| ![Joblib](https://img.shields.io/badge/Joblib-FF6B6B?style=flat) | Model Persistence |

</div>

---

## üìä M√©tricas y Rendimiento del Modelo

<div align="center">

### üéØ **Resultados de Entrenamiento**
| M√©trica | Valor | Descripci√≥n |
|---------|--------|-------------|
| **R¬≤ Score** | `0.7007` | El modelo explica el 70% de la varianza en precios |
| **MSE** | `0.1966` | Error cuadr√°tico medio en escala logar√≠tmica |
| **Datos de Entrenamiento** | `1,050` | Propiedades utilizadas para entrenamiento |
| **Features** | `8` | Variables predictivas optimizadas |

### üîç **Validaci√≥n Externa**
| M√©trica | Valor | Descripci√≥n |
|---------|--------|-------------|
| **Datos de Prueba** | `282` | Propiedades nuevas obtenidas por web scraping |
| **Error Absoluto Promedio** | `19.44%` | Error en predicciones con datos reales |
| **Consistencia** | `‚úÖ Validado` | Error concuerda con m√©tricas de entrenamiento |
| **Rango de Confianza** | `70-80%` | Precisi√≥n esperada en predicciones |

<div align="center">
<img src="img/validacion/porcentaje_error.png" alt="Distribuci√≥n de Errores de Validaci√≥n" width="600"/>
<p><em>Distribuci√≥n del porcentaje de error en 282 propiedades de validaci√≥n externa</em></p>
</div>

</div>

---

## ü§ñ Modelo de Machine Learning

### üìã **Especificaciones T√©cnicas**

**Algoritmo**: Random Forest Regressor  
**Optimizaci√≥n**: Grid Search con validaci√≥n cruzada (K=5)  
**Target**: Precios en escala logar√≠tmica (`log1p`)  

#### **Hiperpar√°metros Optimizados**
```python
RandomForestRegressor(
    n_estimators=500,      # √Årboles en el bosque
    max_depth=30,          # Profundidad m√°xima
    min_samples_split=5,   # M√≠nimo para dividir nodo
    min_samples_leaf=2,    # M√≠nimo en hoja
    max_features="sqrt",   # Features por divisi√≥n
    random_state=42,       # Reproducibilidad
    n_jobs=-1             # Paralelizaci√≥n
)
```

#### **Features Engineering**
| Feature | Descripci√≥n | Importancia |
|---------|-------------|------------|
| `metros_cuadrados` | √Årea de la propiedad | 26.5% |
| `log_metros_cuadrados` | √Årea en escala logar√≠tmica | 22.6% |
| `m2_x_costo_vida` | Interacci√≥n √°rea-regi√≥n | 17.7% |
| `densidad` | (hab + ba√±os) / m¬≤ | 12.1% |
| `ba√±os` | N√∫mero de ba√±os | 9.2% |
| `hab_x_ba√±os` | Interacci√≥n habitaciones-ba√±os | 6.3% |
| `habitaciones` | N√∫mero de habitaciones | 3.6% |
| `costo_vida` | Factor regional | 2.0% |

### üéØ **Validaci√≥n y Pruebas**

#### **M√©tricas de Entrenamiento**
- **Datos**: 1,050 propiedades procesadas
- **Divisi√≥n**: 67% entrenamiento, 33% validaci√≥n
- **R¬≤ Score**: 0.7007 (70.07% de varianza explicada)
- **RMSE**: 0.4433 (en escala logar√≠tmica)
- **MAE**: 0.3291 (en escala logar√≠tmica)

#### **Validaci√≥n Externa Rigurosa**
- **Datos nuevos**: 282 propiedades obtenidas por web scraping independiente
- **Error absoluto promedio**: 19.44%
- **Rango de error**: 5.8% - 25.0%
- **Consistencia**: ‚úÖ Error concordante con R¬≤ (0.30 faltante ‚âà 19% error)

<div align="center">
<img src="img/validacion/Real_vs_prediccion.png" alt="Comparaci√≥n Precios Reales vs Predicciones" width="700"/>
<p><em>An√°lisis comparativo entre precios reales del mercado y predicciones del modelo</em></p>
</div>

---

## üîÑ Automatizaci√≥n con n8n

### ü§ñ **Agente Inmobiliario IA**

Implementamos un workflow inteligente en **n8n** que act√∫a como un agente de consultas inmobiliarias automatizado:

#### **Caracter√≠sticas del Agente**
- **Modelo LLM**: Google Gemini 2.5 Pro
- **Protocolo**: Model Context Protocol (MCP)
- **Endpoints**: Conectado a API de InmoPipeline
- **Capacidades**: Consultas autom√°ticas sin intervenci√≥n humana

#### **Funcionalidades Disponibles**
1. **üìç Consultas por Regi√≥n**: `/propiedades_region/{region}`
2. **üèôÔ∏è Consultas por Ciudad**: `/propiedades_ciudad/{ciudad}`  
3. **üéØ Predicci√≥n de Precios**: `/model` (ML endpoint)
4. **üìä Informaci√≥n del Modelo**: M√©tricas y rendimiento autom√°tico

#### **Workflow n8n**
```mermaid
graph LR
    A[üí¨ Chat Input] --> B[ü§ñ Gemini Agent]
    B --> C[üîó MCP Client]
    C --> D[üåê API InmoPipeline]
    D --> E[üìä Response Processing]
    E --> F[üí¨ Chat Output]
```

**Ejemplo de Uso**:
> *Usuario*: "¬øCu√°nto cuesta un apartamento de 80m¬≤ con 3 habitaciones en Bogot√°?"  
> *Agente*: Ejecuta autom√°ticamente `/model` ‚Üí Responde con predicci√≥n + m√©tricas del modelo

<div align="center">
<img src="img/n8n agent/agent.png" alt="Agente Inmobiliario IA con n8n" width="800"/>
<p><em>Interfaz del agente inmobiliario IA desarrollado en n8n con Google Gemini</em></p>
</div>

---

## üîÆ Roadmap del Proyecto

- [x] ‚úÖ **v1.0**: Web Scraping y ETL Pipeline
- [x] ‚úÖ **v1.1**: Base de datos DuckDB y exportaci√≥n CSV
- [x] ‚úÖ **v2.0**: An√°lisis exploratorio completo con Streamlit
- [x] ‚úÖ **v2.1**: Dashboard interactivo con m√©tricas y visualizaciones
- [x] ‚úÖ **v3.0**: Modelo Random Forest entrenado (R¬≤=0.7007)
- [x] ‚úÖ **v3.1**: Validaci√≥n externa con 282 propiedades (19.44% error)
- [x] ‚úÖ **v3.2**: API REST con FastAPI desplegada en Render
- [x] ‚úÖ **v3.3**: Automatizaci√≥n con n8n workflows
- [ ] ÔøΩ **v4.0**: Containerizaci√≥n con Docker
- [ ] üìã **v4.1**: CI/CD Pipeline automatizado
- [ ] üîÑ **v4.2**: Reentrenamiento autom√°tico del modelo

---

## üåê Enlaces y Recursos

- üöÄ **API en Producci√≥n**: [inmopipeline.onrender.com](https://inmopipeline.onrender.com)
- üìä **Dashboard Streamlit**: [inmopipeline.streamlit.app](https://inmopipeline.streamlit.app)
- üîÑ **Workflows n8n**: Automatizaci√≥n de consultas inmobiliarias
- üìà **Documentaci√≥n API**: [/docs](https://inmopipeline.onrender.com/docs) (Swagger UI)
- üîó **MCP Server**: [/mcp](https://inmopipeline.onrender.com/mcp) (Model Context Protocol)

---

## üèÜ Resultados Destacados

### üìà **Logros del Proyecto**

- ‚úÖ **Pipeline End-to-End Completo**: Desde web scraping hasta predicci√≥n en producci√≥n
- ‚úÖ **Modelo Validado Externamente**: 19.44% error absoluto con datos reales nuevos
- ‚úÖ **Precisi√≥n Robusta**: R¬≤ = 0.7007 confirmado en 282 propiedades independientes
- ‚úÖ **Automatizaci√≥n Inteligente**: Agente IA con n8n para consultas autom√°ticas
- ‚úÖ **Despliegue en Producci√≥n**: API funcionando 24/7 en Render Cloud
- ‚úÖ **Concordancia de M√©tricas**: Error externo consistente con m√©tricas de entrenamiento

### üéØ **Casos de Uso Validados**

| Tipo de Propiedad | Predicci√≥n Promedio | Precisi√≥n |
|-------------------|-------------------|-----------|
| Apartamentos urbanos | $400M - $600M COP | ¬±15-20% |
| Casas residenciales | $600M - $1.2B COP | ¬±18-25% |
| Propiedades premium | $1B+ COP | ¬±20-30% |

### üî¨ **Validaci√≥n Cient√≠fica**

El modelo ha sido rigurosamente validado:
- **Entrenamiento**: 1,050 propiedades con validaci√≥n cruzada K=5
- **Testing externo**: 282 propiedades completamente nuevas
- **Error coherente**: 19.44% externo vs 30% esperado del R¬≤ faltante
- **Distribuci√≥n de errores**: Normal, sin sesgos sistem√°ticos

---

## üì∏ Galer√≠a de Resultados

### üéØ **Visualizaciones del Modelo**

<div align="center">

| M√©trica de Validaci√≥n | An√°lisis de Precisi√≥n |
|:---------------------:|:---------------------:|
| <img src="img/validacion/porcentaje_error.png" alt="Distribuci√≥n de Errores" width="400"/> | <img src="img/validacion/Precio real.png" alt="An√°lisis de Precios" width="400"/> |
| *Distribuci√≥n del error absoluto en validaci√≥n externa* | *Precio real del inmueble* |

---

## üë• Contribuciones

Este proyecto fue desarrollado como parte de un pipeline completo de ingenier√≠a y ciencia de datos, integrando:

- **Data Engineering**: ETL automatizado y almacenamiento optimizado
- **Machine Learning**: Modelo predictivo con validaci√≥n externa rigurosa  
- **MLOps**: Despliegue automatizado y monitoreo en producci√≥n
- **Automation**: Workflows inteligentes con n8n y MCP

---

<div align="center">

**üöÄ InmoPipeline - An√°lisis Inmobiliario Inteligente**  
*Desarrollado con ‚ù§Ô∏è para el mercado inmobiliario colombiano*

[![API Status](https://img.shields.io/badge/API-Check_Status-blue?style=for-the-badge&logo=render)](https://inmopipeline.onrender.com)
[![Documentation](https://img.shields.io/badge/Docs-API_Reference-green?style=for-the-badge&logo=swagger)](https://inmopipeline.onrender.com/docs)

</div>
